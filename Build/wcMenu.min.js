/*!
 * Web Cabin Menu - A simple menu and toolbar system.
 *
 * Dependancies:
 *  JQuery 1.11.1
 *
 * Author: Jeff Houde (lochemage@webcabin.org)
 * Web: https://menu.webcabin.org/
 * API: https://menu.api.webcabin.org/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */
"use strict";function wcMenu(e,t,n){this.$container=$(e),this.$outer=$(t),this.$outer.attr("tabindex")||this.$outer.attr("tabindex","1"),this._menuOptions=[],this._options={data:!1,manualUpdate:!1,version:""};for(var r in n)this._options[r]=n[r];this.$fileMenu=$('<ul class="wcMenu wcMenuNoHighlights"></ul>'),this.$toolbar=$('<div class="wcMenuToolbar wcMenuNoHighlights"></div>'),this.$version=$('<div class="wcMenuVersionTag">'+this._options.version+"</div>"),this.$container.append(this.$fileMenu),this.$container.append(this.$toolbar),this.$fileMenu.append(this.$version);var i=this;this.$container.on("mouseenter","ul.wcMenu > li",function(e){i.__onMouseEnter.call(this,e,i)}),this.$container.on("click","ul.wcMenu > li > ul",function(e){i.__onClicked.call(this,e,i)}),this.$container.on("mouseleave","ul.wcMenu > li",function(e){i.__onMouseLeave.call(this,e,i)}),this.$container.on("mouseleave","ul.wcMenu > li > ul",function(e){i.__onSubMouseLeave.call(this,e,i)}),this.$outer.on("keydown",function(e){i.__onKey.call(this,e,i)}),this._options.manualUpdate||window.requestAnimationFrame(function(){i.__autoUpdate()})}wcMenu.prototype={update:function(){for(var e=0;e<this._menuOptions.length;++e){var t=this._menuOptions[e].items;for(var n=0;n<t.length;++n){var r=t[n];r.display&&(r.$itemSpan.html("&nbsp;&nbsp;&nbsp;&nbsp;"+r.display(this._options.data)),r.$itemSpan.prepend(r.$icon).append(r.$hotkey));if(r.icon){var i=r.icon(this._options.data);r.$icon.removeClass().addClass("wcMenuIcon wcButton "+i),r.$toolbarIcon.removeClass().addClass("wcMenuIcon wcButton "+i)}if(r.description){var s=r.description(this._options.data);r.$itemSpan.attr("title",s),r.$toolbar&&r.$toolbarSpan.attr("title",s+(r.hotkeyString?" ("+r.hotkeyString+")":""))}if(r.condition){var o=!r.condition(this._options.data);r.$itemSpan.toggleClass("disabled",o),r.$toolbar&&r.$toolbar.toggleClass("disabled",o)}}}},version:function(e){return e!==undefined&&this.$version.text(e),this.$version.text()},addOption:function(e,t,n){function v(e){if($(this).hasClass("disabled"))return;r.click&&r.click(d.data)}if(!t||!e)return!1;var r={name:t};n&&typeof n.onActivated=="function"&&(r.click=n.onActivated),n&&typeof n.display=="function"&&(r.display=n.display);var i=null,s=null;for(var o=0;o<this._menuOptions.length;++o)if(this._menuOptions[o].name===e){i=this._menuOptions[o];break}if(n&&typeof n.toolbarIndex=="number"){r.$toolbar=$('<div><span class="wcMenuIcon wcButton"/></div>'),r.$toolbarSpan=r.$toolbar.children("span");var u=this.$toolbar.children();u.length===0||n.toolbarIndex<0||n.toolbarIndex>=u.length?this.$toolbar.append(r.$toolbar):r.$toolbar.insertBefore(u[n.toolbarIndex])}n&&typeof n.condition=="function"&&(r.condition=n.condition);if(!i){s=$('<li class="wcMenuCategory"><span>'+e+"</span><ul></ul></li>"),i={name:e,$category:s,items:[]};if(this._menuOptions.length===0)this.$fileMenu.append(s),this._menuOptions.push(i);else{var a=this._menuOptions.length;n&&typeof n.categoryIndex=="number"&&n.categoryIndex>=0&&n.categoryIndex<a&&(a=n.categoryIndex),a<this._menuOptions.length?(s.insertBefore(this._menuOptions[a].$category),this._menuOptions.splice(a,0,i)):(s.insertAfter(this._menuOptions[this._menuOptions.length-1].$category),this._menuOptions.push(i))}}else s=i.$category;r.$item=$('<li><span class="wcMenuItem">&nbsp;&nbsp;&nbsp;&nbsp;'+t+"</span></li>"),r.$itemSpan=r.$item.children("span");var f=$('<i class="wcMenuIcon wcButton"/>');n&&n.icon&&(typeof n.icon=="string"?(f.addClass(n.icon),r.$toolbar&&r.$toolbarSpan.addClass(n.icon)):typeof n.icon=="function"&&(r.icon=n.icon)),r.$icon=f,r.$toolbar&&(r.$toolbarIcon=r.$toolbarSpan),n&&typeof n.description=="string"?(r.$itemSpan.attr("title",n.description),r.$toolbar&&r.$toolbarSpan.attr("title",n.description)):n&&typeof n.description=="function"&&(r.description=n.description);var l=$('<span class="wcMenuHotkey">');if(n&&typeof n.hotkeys=="string"){r.hotkeys=[];var c=n.hotkeys.indexOf(",")>-1?n.hotkeys.split(","):[n.hotkeys];for(var o=0;o<c.length;++o){var h=c[o].toLowerCase(),p={ctrlKey:!1,altKey:!1,shiftKey:!1};h.indexOf("ctrl")>-1&&(p.ctrlKey=!0),h.indexOf("alt")>-1&&(p.altKey=!0),h.indexOf("shift")>-1&&(p.shiftKey=!0),h.indexOf("del")>-1?p.keyCode=46:h.indexOf("ent")>-1||h.indexOf("ret")>-1?p.keyCode=13:h.indexOf("space")>-1||h.indexOf("spc")>-1?p.keyCode=32:p.keyCode=h.toUpperCase().charCodeAt(h.length-1),r.hotkeys.push(p)}r.$hotkey=l,r.hotkeyString=n.hotkeys,l.text(n.hotkeys),r.$toolbar&&r.$toolbarSpan.attr("title",r.$toolbarSpan.attr("title")+" ("+n.hotkeys+")")}r.$itemSpan.prepend(f).append(l),i.items.length===0?(i.items.push(r),s.children("ul").append(r.$item)):(a=i.items.length,n&&typeof n.itemIndex=="number"&&n.itemIndex>=0&&n.itemIndex<a&&(a=n.itemIndex),a<i.items.length?(r.$item.insertBefore(i.items[a].$item),i.items.splice(a,0,r)):(r.$item.insertAfter(i.items[i.items.length-1].$spacer||i.items[i.items.length-1].$item),i.items.push(r)));var d=this._options;return r.$itemSpan.click(v),r.$toolbar&&r.$toolbar.click(v),!0},addSpacer:function(e,t){var n=null;for(var r=0;r<this._menuOptions.length;++r)if(this._menuOptions[r].name===e){n=this._menuOptions[r];break}if(!n)return!1;if(t<0||t>=n.items.length)t=n.items.length-1;var i=n.items[t];return i.$spacer=$('<li><hr class="wcMenuSeparator"></li>'),i.$spacer.insertAfter(i.$item),!0},addToolbarSpacer:function(e,t){var n=null;for(var r=0;r<this._menuOptions.length;++r)if(this._menuOptions[r].name===e){n=this._menuOptions[r];break}if(!n)return!1;if(t<0||t>=n.items.length)t=n.items.length-1;var i=n.items[t];return i.$toolbar&&(i.$toolbarSpacer=$('<div class="ARPG_Separator"></div>'),i.$toolbarSpacer.insertAfter(i.$toolbar)),!0},__autoUpdate:function(){this.update();var e=this;window.requestAnimationFrame(function(){e.__autoUpdate()})},__onMouseEnter:function(e,t){var n=$(this);setTimeout(function(){n.is(":hover")&&n.addClass("wcMenuOpen").addClass("wcMenuItemHover")},100)},__onClicked:function(e,t){t.$container.find("ul.wcMenu li ul").css("display","none"),setTimeout(function(){t.$container.find("ul.wcMenu li ul").css("display","")},200)},__onMouseLeave:function(e,t){$(this).find(e.toElement).length===0&&$(this).removeClass("wcMenuOpen").removeClass("wcMenuItemHover")},__onSubMouseLeave:function(e,t){var n=$(this).parent();n.find(e.toElement).length===0&&n.removeClass("wcMenuOpen").removeClass("wcMenuItemHover")},__onKey:function(e,t){for(var n=0;n<t._menuOptions.length;++n){var r=t._menuOptions[n].items;for(var i=0;i<r.length;++i){var s=r[i];if(s.hotkeys)for(var o=0;o<s.hotkeys.length;++o){var u=s.hotkeys[o];u.ctrlKey==e.ctrlKey&&u.shiftKey==e.shiftKey&&u.altKey==e.altKey&&u.keyCode==e.keyCode&&s.$itemSpan.click()}}}}}