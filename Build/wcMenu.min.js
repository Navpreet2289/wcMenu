/*!
 * Web Cabin Menu - A simple menu and toolbar system.
 *
 * Dependancies:
 *  JQuery 1.11.1
 *
 * Author: Jeff Houde (lochemage@webcabin.org)
 * Web: https://menu.webcabin.org/
 * API: https://menu.api.webcabin.org/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */
"use strict";function wcMenu(e,t){this.$container=$(e),this._menuOptions=[],this._options={outer:"body",data:!1,manualUpdate:!1,version:""};for(var n in t)this._options[n]=t[n];this.$fileMenu=$('<ul class="wcMenu wcMenuNoHighlights"></ul>'),this.$toolbar=$('<div class="wcMenuToolbar wcMenuNoHighlights"></div>'),this.$version=$('<div class="wcMenuVersionTag">'+this._options.version+"</div>"),this.$outer=$(this._options.outer),this.$container.append(this.$fileMenu),this.$container.append(this.$toolbar),this.$fileMenu.append(this.$version),this.$outer.attr("tabindex")||this.$outer.attr("tabindex","1");var r=this;this.$container.on("mouseenter","ul.wcMenu > li",function(e){r.__onMouseEnter.call(this,e,r)}),this.$container.on("click","ul.wcMenu > li > ul",function(e){r.__onClicked.call(this,e,r)}),this.$container.on("mouseleave","ul.wcMenu > li",function(e){r.__onMouseLeave.call(this,e,r)}),this.$container.on("mouseleave","ul.wcMenu > li > ul",function(e){r.__onSubMouseLeave.call(this,e,r)}),this.$outer.on("keydown",function(e){r.__onKey.call(this,e,r)}),this._options.manualUpdate||window.requestAnimationFrame(function(){r.__autoUpdate()})}wcMenu.prototype={update:function(){for(var e=0;e<this._menuOptions.length;++e){var t=this._menuOptions[e].items;for(var n=0;n<t.length;++n){var r=t[n];if(r.display){var i=r.display(this._options.data);i!==r.lastDisplay&&(r.$itemSpan.html("&nbsp;&nbsp;&nbsp;&nbsp;"+i),r.$itemSpan.prepend(r.$icon).append(r.$hotkey),r.lastDisplay=i)}if(r.toggle){var s=r.toggle(this._options.data);s!==r.lastToggle&&(r.$icon.toggleClass("wcButtonActive",s),r.$toolbarIcon&&r.$toolbarIcon.parent().toggleClass("wcButtonActive",s),r.lastToggle=s)}if(r.icon){var o=r.icon(this._options.data);o!==r.lastIcon&&(r.$icon.children("i").removeClass().addClass(""+o),r.$toolbarIcon&&r.$toolbarIcon.removeClass().addClass(""+o),r.lastIcon=o)}if(r.description){var u=r.description(this._options.data);u!==r.lastDesc&&(r.$itemSpan.attr("title",u),r.$toolbar&&r.$toolbarSpan.attr("title",u+(r.hotkeyString?" ("+r.hotkeyString+")":"")),r.lastDesc=u)}if(r.condition){var a=!r.condition(this._options.data);a!==r.lastDisabled&&(r.$itemSpan.toggleClass("disabled",a),r.$toolbar&&r.$toolbar.toggleClass("disabled",a),r.lastDisabled=a)}}}},version:function(e){return e!==undefined&&this.$version.text(e),this.$version.text()},addOption:function(e,t,n){function v(e){if($(this).hasClass("disabled"))return;r.click&&r.click(d.data)}if(!t||!e)return!1;var r={name:t};n&&typeof n.onActivated=="function"&&(r.click=n.onActivated),n&&typeof n.display=="function"&&(r.display=n.display),n&&typeof n.toggle=="function"&&(r.toggle=n.toggle);var i=null,s=null;for(var o=0;o<this._menuOptions.length;++o)if(this._menuOptions[o].name===e){i=this._menuOptions[o];break}if(n&&typeof n.toolbarIndex=="number"){r.$toolbar=$('<div class="wcMenuIcon wcButton"><span></span></div>'),r.$toolbarSpan=r.$toolbar.children("span");var u=this.$toolbar.children();u.length===0||n.toolbarIndex<0||n.toolbarIndex>=u.length?this.$toolbar.append(r.$toolbar):r.$toolbar.insertBefore(u[n.toolbarIndex])}n&&typeof n.condition=="function"&&(r.condition=n.condition);if(!i){s=$('<li class="wcMenuCategory"><span>'+e+'</span><ul class="wcMenuCategoryDropdown"></ul></li>'),i={name:e,$category:s,items:[]};if(this._menuOptions.length===0)this.$fileMenu.append(s),this._menuOptions.push(i);else{var a=this._menuOptions.length;n&&typeof n.categoryIndex=="number"&&n.categoryIndex>=0&&n.categoryIndex<a&&(a=n.categoryIndex),a<this._menuOptions.length?(s.insertBefore(this._menuOptions[a].$category),this._menuOptions.splice(a,0,i)):(s.insertAfter(this._menuOptions[this._menuOptions.length-1].$category),this._menuOptions.push(i))}}else s=i.$category;r.$item=$('<li><span class="wcMenuItem">&nbsp;&nbsp;&nbsp;&nbsp;'+t+"</span></li>"),r.$itemSpan=r.$item.children("span");var f=$('<div class="wcMenuIcon wcButton"><i></i></div>');n&&n.icon&&(typeof n.icon=="string"?(f.children("i").addClass(n.icon),r.$toolbar&&r.$toolbarSpan.addClass(n.icon)):typeof n.icon=="function"&&(r.icon=n.icon)),r.$icon=f,r.$toolbar&&(r.$toolbarIcon=r.$toolbarSpan),n&&typeof n.description=="string"?(r.$itemSpan.attr("title",n.description),r.$toolbar&&r.$toolbarSpan.attr("title",n.description)):n&&typeof n.description=="function"?r.description=n.description:(r.$itemSpan.attr("title",""),r.$toolbar&&r.$toolbarSpan.attr("title",""));var l=$('<span class="wcMenuHotkey">');if(n&&typeof n.hotkeys=="string"){r.hotkeys=[];var c=n.hotkeys.indexOf(",")>-1?n.hotkeys.split(","):[n.hotkeys];for(var o=0;o<c.length;++o){var h=c[o].toLowerCase(),p={ctrlKey:!1,altKey:!1,shiftKey:!1};h.indexOf("ctrl")>-1&&(p.ctrlKey=!0),h.indexOf("alt")>-1&&(p.altKey=!0),h.indexOf("shift")>-1&&(p.shiftKey=!0),h.indexOf("del")>-1?p.keyCode=46:h.indexOf("ent")>-1||h.indexOf("ret")>-1?p.keyCode=13:h.indexOf("space")>-1||h.indexOf("spc")>-1?p.keyCode=32:p.keyCode=h.toUpperCase().charCodeAt(h.length-1),r.hotkeys.push(p)}r.$hotkey=l,r.hotkeyString=n.hotkeys,l.text(n.hotkeys),r.$toolbar&&r.$toolbarSpan.attr("title",r.$toolbarSpan.attr("title")+(n.hotkeys?" ("+n.hotkeys+")":""))}r.$itemSpan.prepend(f).append(l),i.items.length===0?(i.items.push(r),s.children("ul").append(r.$item)):(a=i.items.length,n&&typeof n.itemIndex=="number"&&n.itemIndex>=0&&n.itemIndex<a&&(a=n.itemIndex),a<i.items.length?(r.$item.insertBefore(i.items[a].$item),i.items.splice(a,0,r)):(r.$item.insertAfter(i.items[i.items.length-1].$spacer||i.items[i.items.length-1].$item),i.items.push(r)));var d=this._options;return r.$itemSpan.click(v),r.$toolbar&&r.$toolbar.click(v),!0},removeOption:function(e,t){if(!t||!e)return!1;var n=null,r=null;for(var i=0;i<this._menuOptions.length;++i)if(this._menuOptions[i].name===e){n=this._menuOptions[i];break}if(!n)return!1;var s=null;for(var i=0;i<n.items.length;++i)if(n.items[i].name===t){s=n.items[i],n.items.splice(i,1);break}if(!s)return!1;n.items.length===0&&(n.$category.remove(),this._menuOptions.splice(this._menuOptions.indexOf(n),1)),s.$item.remove(),s.$toolbar.remove(),s.$spacer&&s.$spacer.remove(),s.$toolbarSpacer&&s.$toolbarSpacer.remove()},addSpacer:function(e,t){if(!t||!e)return!1;var n=null;for(var r=0;r<this._menuOptions.length;++r)if(this._menuOptions[r].name===e){n=this._menuOptions[r];break}if(!n)return!1;var i=null;for(var r=0;r<n.items.length;++r)if(n.items[r].name===t){i=n.items[r];break}return i?(i.$spacer=$('<li><hr class="wcMenuSeparator"></li>'),i.$spacer.insertAfter(i.$item),!0):!1},removeSpacer:function(e,t){if(!t||!e)return!1;var n=null;for(var r=0;r<this._menuOptions.length;++r)if(this._menuOptions[r].name===e){n=this._menuOptions[r];break}if(!n)return!1;var i=null;for(var r=0;r<n.items.length;++r)if(n.items[r].name===t){i=n.items[r];break}return i?(i.$spacer&&i.$spacer.remove(),!0):!1},addToolbarSpacer:function(e,t){if(!t||!e)return!1;var n=null;for(var r=0;r<this._menuOptions.length;++r)if(this._menuOptions[r].name===e){n=this._menuOptions[r];break}if(!n)return!1;var i=null;for(var r=0;r<n.items.length;++r)if(n.items[r].name===t){i=n.items[r];break}return i?(i.$toolbar&&(i.$toolbarSpacer=$('<div class="wcMenuSeparator"></div>'),i.$toolbarSpacer.insertAfter(i.$toolbar)),!0):!1},removeToolbarSpacer:function(e,t){if(!t||!e)return!1;var n=null;for(var r=0;r<this._menuOptions.length;++r)if(this._menuOptions[r].name===e){n=this._menuOptions[r];break}if(!n)return!1;var i=null;for(var r=0;r<n.items.length;++r)if(n.items[r].name===t){i=n.items[r];break}return i?(i.$toolbarSpacer&&i.$toolbarSpacer.remove(),!0):!1},optionOnActivated:function(e,t,n){if(!t||!e)return!1;if(typeof n!="function")return!1;var r=null;for(var i=0;i<this._menuOptions.length;++i)if(this._menuOptions[i].name===e){r=this._menuOptions[i];break}if(!r)return!1;var s=null;for(var i=0;i<r.items.length;++i)if(r.items[i].name===t){s=r.items[i];break}return s?(s.click=n,!0):!1},optionDisplay:function(e,t,n){if(!t||!e)return!1;var r=null;for(var i=0;i<this._menuOptions.length;++i)if(this._menuOptions[i].name===e){r=this._menuOptions[i];break}if(!r)return!1;var s=null;for(var i=0;i<r.items.length;++i)if(r.items[i].name===t){s=r.items[i];break}return s?(typeof n!="function"?(s.display=undefined,delete s.display):s.display=n,!0):!1},optionToggle:function(e,t,n){if(!t||!e)return!1;var r=null;for(var i=0;i<this._menuOptions.length;++i)if(this._menuOptions[i].name===e){r=this._menuOptions[i];break}if(!r)return!1;var s=null;for(var i=0;i<r.items.length;++i)if(r.items[i].name===t){s=r.items[i];break}return s?(typeof n!="function"?(s.toggle=undefined,delete s.toggle,s.$icon.removeClass("wcButtonActive"),item.$toolbarIcon&&s.$toolbarIcon.parent().removeClass("wcButtonActive")):s.toggle=n,!0):!1},optionIcon:function(e,t,n){if(!t||!e)return!1;var r=null;for(var i=0;i<this._menuOptions.length;++i)if(this._menuOptions[i].name===e){r=this._menuOptions[i];break}if(!r)return!1;var s=null;for(var i=0;i<r.items.length;++i)if(r.items[i].name===t){s=r.items[i];break}return s?(typeof n!="function"?(s.icon=undefined,delete s.icon,typeof n=="string"&&(s.$icon.children("i").removeClass().addClass(""+n),s.$toolbar&&s.$toolbarIcon.removeClass().addClass(""+n))):s.icon=n,!0):!1},optionDescription:function(e,t,n){if(!t||!e)return!1;var r=null;for(var i=0;i<this._menuOptions.length;++i)if(this._menuOptions[i].name===e){r=this._menuOptions[i];break}if(!r)return!1;var s=null;for(var i=0;i<r.items.length;++i)if(r.items[i].name===t){s=r.items[i];break}return s?(typeof n!="function"?(s.description=undefined,delete s.description,typeof n=="string"&&(s.$itemSpan.attr("title",n),s.$toolbar&&s.$toolbarSpan.attr("title",n+(item.hotkeyString?" ("+item.hotkeyString+")":"")))):s.description=n,!0):!1},optionHotkeys:function(e,t,n){if(!t||!e)return!1;var r=null;for(var i=0;i<this._menuOptions.length;++i)if(this._menuOptions[i].name===e){r=this._menuOptions[i];break}if(!r)return!1;var s=null;for(var i=0;i<r.items.length;++i)if(r.items[i].name===t){s=r.items[i];break}if(!s)return!1;if(typeof n=="string"){s.hotkeys=[];var o=n.indexOf(",")>-1?n.split(","):[n];for(var i=0;i<o.length;++i){var u=o[i].toLowerCase(),a={ctrlKey:!1,altKey:!1,shiftKey:!1};u.indexOf("ctrl")>-1&&(a.ctrlKey=!0),u.indexOf("alt")>-1&&(a.altKey=!0),u.indexOf("shift")>-1&&(a.shiftKey=!0),u.indexOf("del")>-1?a.keyCode=46:u.indexOf("ent")>-1||u.indexOf("ret")>-1?a.keyCode=13:u.indexOf("space")>-1||u.indexOf("spc")>-1?a.keyCode=32:a.keyCode=u.toUpperCase().charCodeAt(u.length-1),s.hotkeys.push(a)}s.$hotkey.text(n);if(s.$toolbar){var f=s.$toolbarSpan.attr("title");s.hotkeyString&&(f=f.replace(" ("+s.hotkeyString+")","")),s.$toolbarSpan.attr("title",f+(n?" ("+n+")":""))}s.hotkeyString=n}return!0},optionCondition:function(e,t,n){if(!t||!e)return!1;var r=null;for(var i=0;i<this._menuOptions.length;++i)if(this._menuOptions[i].name===e){r=this._menuOptions[i];break}if(!r)return!1;var s=null;for(var i=0;i<r.items.length;++i)if(r.items[i].name===t){s=r.items[i];break}return s?(typeof n!="function"?(s.condition=undefined,delete s.condition):s.condition=n,!0):!1},__autoUpdate:function(){this.update();var e=this;window.requestAnimationFrame(function(){e.__autoUpdate()})},__onMouseEnter:function(e,t){var n=$(this);setTimeout(function(){n.is(":hover")&&n.addClass("wcMenuOpen").addClass("wcMenuItemHover")},100)},__onClicked:function(e,t){t.$container.find("ul.wcMenu li ul").css("display","none"),setTimeout(function(){t.$container.find("ul.wcMenu li ul").css("display","")},200)},__onMouseLeave:function(e,t){$(this).find(e.toElement).length===0&&$(this).removeClass("wcMenuOpen").removeClass("wcMenuItemHover")},__onSubMouseLeave:function(e,t){var n=$(this).parent();n.find(e.toElement).length===0&&n.removeClass("wcMenuOpen").removeClass("wcMenuItemHover")},__onKey:function(e,t){for(var n=0;n<t._menuOptions.length;++n){var r=t._menuOptions[n].items;for(var i=0;i<r.length;++i){var s=r[i];if(s.hotkeys)for(var o=0;o<s.hotkeys.length;++o){var u=s.hotkeys[o];if(u.ctrlKey==e.ctrlKey&&u.shiftKey==e.shiftKey&&u.altKey==e.altKey&&u.keyCode==e.keyCode)return s.$itemSpan.click(),e.stopPropagation(),e.preventDefault(),!1}}}}}